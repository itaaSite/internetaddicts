---
import Article from "@/components/Article.astro"
import Authors from "@/components/Authors.astro"
import Tags from "@/components/Tags.astro"
import Layout from "@/layout/Layout.astro"
import { getAllPosts } from "@/lib/getPosts"
import { slugify } from "@/lib/utils"
import { Icon } from "astro-icon/components"

export async function getStaticPaths() {
	const posts = await getAllPosts("posts")
	const authors = [...new Set(posts.map(post => post.data.author || "АИЗ"))]

	return authors.map(author => ({
		params: { author: slugify(author) },
		props: { label: author },
	}))
}

const { author } = Astro.params
const { label } = Astro.props

const posts = await getAllPosts("posts")
const filteredByAuthor = posts.filter(post => slugify(post.data.author || "АИЗ") === author)
---

<Layout
	data-pagefind-ignore
	title={`Автор: ${label}`}
	desc="Статьи автора в архиве АИЗ."
>
	<h1 class="text-3xl text-gray-700 font-semibold flex gap-2 items-center">
		<Icon name="mdi:account-circle-outline" />
		<span>{`Автор: ${label}`}</span>
	</h1>

	<Authors />
	<Tags />

	<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
		{
			filteredByAuthor.map(post => <Article slug={post.slug} data={post.data} />)
		}
	</div>
</Layout>
