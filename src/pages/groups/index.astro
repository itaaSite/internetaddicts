---
import GroupArticle from "@/components/GroupArticle.astro"
import Layout from "@/layout/Layout.astro"
import { Icon } from "astro-icon/components"
import { getCollection } from "astro:content"

const groups = await getCollection("groups")

const dayOrder = {
	Понедельник: 1,
	Вторник: 2,
	Среда: 3,
	Четверг: 4,
	Пятница: 5,
	Суббота: 6,
	Воскресенье: 7,
	По_запросу: 8,
}

const someDate = "2024-12-28"

function sortGroupsByDay(groups) {
	return groups
		.sort((a, b) => {
			const t1 = someDate + a.data.dateTime
			const t2 = someDate + b.data.dateTime
			return new Date(t2).getMilliseconds() - new Date(t1).getMilliseconds()
		})
		.sort((a, b) => {
			return dayOrder[a.data.when] - dayOrder[b.data.when]
		})
}
---

<Layout
	title={`Онлайн и Оффлайн группы`}
	desc={`Время встреч для анонимных интернет-зависимых. Собрания/Встречи и мероприятие каждый день.`}
>
	<h3 class="text-3xl text-gray-700 font-semibold flex gap-2 items-center">
		<Icon name="mdi:account-group" />
		<span>Оффлайн-группы</span>
	</h3>

	<div class="grid grid-cols-1 items-start md:grid-cols-2 lg:grid-cols-4 gap-5">
		{
			groups &&
				sortGroupsByDay(groups.filter(f => f.data.type === "Живая")).map(group => (
					<GroupArticle data={group.data} body={group.body} />
				))
		}
	</div>

	<h3 class="text-3xl text-gray-700 font-semibold flex gap-2 items-center">
		<Icon name="mdi:wifi" />
		<span>Онлайн-группы</span>
	</h3>

	<div class="grid grid-cols-1 items-start md:grid-cols-2 lg:grid-cols-4 gap-5">
		{
			groups &&
				sortGroupsByDay(groups.filter(f => f.data.type === "Онлайн")).map(group => (
					<GroupArticle data={group.data} body={group.body} />
				))
		}
	</div>
</Layout>
