---
import { marked } from "marked"

import Layout from "@/layout/Layout.astro"
import { Icon } from "astro-icon/components"
import { Image } from "astro:assets"
import { getCollection } from "astro:content"

const groups = await getCollection("groups")
const groupsCounter = (await getCollection("groups")).length

const dayOrder = {
	–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: 1,
	–í—Ç–æ—Ä–Ω–∏–∫: 2,
	–°—Ä–µ–¥–∞: 3,
	–ß–µ—Ç–≤–µ—Ä–≥: 4,
	–ü—è—Ç–Ω–∏—Ü–∞: 5,
	–°—É–±–±–æ—Ç–∞: 6,
	–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 7,
	–ü–æ_–∑–∞–ø—Ä–æ—Å—É: 8,
}

const someDate = "2024-12-28"

function sortGroupsByDay(groups) {
	return groups
		.sort((a, b) => {
			const t1 = someDate + a.data.dateTime
			const t2 = someDate + b.data.dateTime
			return new Date(t2).getMilliseconds() - new Date(t1).getMilliseconds()
		})
		.sort((a, b) => {
			return dayOrder[a.data.when] - dayOrder[b.data.when]
		})
}
---

<Layout
	title={`–û–Ω–ª–∞–π–Ω –∏ –û—Ñ–ª–∞–π–Ω –≥—Ä—É–ø–ø—ã`}
	desc={`–í—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑–∞–≤–∏—Å–∏–º—ã—Ö. –°–æ–±—Ä–∞–Ω–∏–π (${groupsCounter})`}
>
	<h4 class="text-2xl text-gray-700 font-medium">
		–ñ–∏–≤—ã–µ –≥—Ä—É–ø–ø—ã ({groups.filter(f => f.data.type === "–ñ–∏–≤–∞—è").length})
	</h4>
	<div class="grid grid-cols-1 items-start md:grid-cols-2 lg:grid-cols-4 gap-5">
		{
			groups &&
				sortGroupsByDay(groups.filter(f => f.data.type === "–ñ–∏–≤–∞—è")).map(group => (
					<div class="p-4 bg-white rounded-lg ring-1 ring-gray-100">
						<div class="flex flex-col gap-3">
							<div class="flex items-center gap-3 flex-wrap">
								<Image
									src={group.data.logo}
									class="w-8 h-8 rounded-full object-cover"
									alt={group.data.title}
								/>
								<h4 class="font-bold">{group.data.title}</h4>
							</div>

							<p class="flex items-center gap-2">
								<Icon name="mdi:alarm" />
								<span>{group.data.when}</span>{" "}
								<span class="font-bold">{group.data.dateTime}</span>
							</p>
							<p set:html={marked(group.body)} />
							<a
								href={group.data.link}
								class="bg-blue-500 text-white justify-center px-2 py-1.5 rounded-lg flex items-center gap-1 transition-colors duration-75 ease-linear hover:bg-blue-400"
							>
								<Icon name="mdi:telegram" />
								<span>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</span>
							</a>
						</div>
					</div>
				))
		}
	</div>

	<h4 class="text-2xl text-gray-700 font-medium">
		–û–Ω–ª–∞–π–Ω-–≥—Ä—É–ø–ø—ã ({groups.filter(f => f.data.type === "–û–Ω–ª–∞–π–Ω").length})
	</h4>

	<a
		href="/posts/sozdaem-svoyu-gruppu-aiz-za-3-min"
		class="rounded-xl px-3 py-1.5 self-start font-medium bg-green-50 ring-1 ring-green-400 text-green-600"
		>–°–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –≥—Ä—É–ø–ø—É ü´Ç</a
	>

	<div class="grid grid-cols-1 items-start md:grid-cols-2 lg:grid-cols-4 gap-5">
		{
			groups &&
				sortGroupsByDay(groups.filter(f => f.data.type === "–û–Ω–ª–∞–π–Ω")).map(group => (
					<div class="p-6 bg-white rounded-xl">
						<div class="flex flex-col gap-3">
							<div class="flex items-center gap-3 flex-wrap">
								<Image
									src={group.data.logo}
									class="w-10 h-10 rounded-full object-cover"
									alt={group.data.title}
								/>
								<h4 class="font-bold">{group.data.title}</h4>
							</div>

							<p class="flex items-center gap-2">
								<Icon name="mdi:alarm" />
								<span>{group.data.when}</span>{" "}
								<span class="font-bold">{group.data.dateTime}</span>
							</p>
							<div class="text-zinc-600" set:html={marked(group.body)} />

							<a
								href={group.data.link}
								class="bg-blue-500 text-white justify-center px-2 py-1.5 rounded-lg flex items-center gap-1 transition-colors duration-75 ease-linear hover:bg-blue-400"
							>
								<Icon name="mdi:telegram" />
								<span>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</span>
							</a>
						</div>
					</div>
				))
		}
	</div>
</Layout>
